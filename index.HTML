<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë§ˆì¼€íŒ… ë„êµ¬ ì›¹í˜ì´ì§€</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SheetJS for Excel import/export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    /* Sidebar */
    .sidebar { width: 16rem; transition: width 0.3s ease-in-out; position: relative; }
    .main-content { margin-left: 16rem; transition: margin-left 0.3s ease-in-out; flex: 1; }
    /* Collapsed state */
    body.sidebar-collapsed .sidebar { width: 4rem; }
    body.sidebar-collapsed .main-content { margin-left: 4rem; }
    body.sidebar-collapsed .sidebar .sidebar-text,
    body.sidebar-collapsed .sidebar .text-4xl,
    body.sidebar-collapsed .sidebar .text-sm,
    body.sidebar-collapsed .sidebar button.text-pink-500 { display: none; }
    body.sidebar-collapsed .sidebar { padding-left: 0.5rem; padding-right: 0.5rem; }
    body.sidebar-collapsed .sidebar ul { padding-left: 0; padding-right: 0; }
    body.sidebar-collapsed .sidebar li { justify-content: center; }
    body.sidebar-collapsed .sidebar li span { display: none; }
    body.sidebar-collapsed .sidebar .w-28 { width: 2.5rem; }
    body.sidebar-collapsed .sidebar li::before { margin-right: 0; }
    /* Toggle Button */
    .sidebar-toggle-btn { position: absolute; top: 0.5rem; right: -12px; z-index: 50; background-color: white; border: 1px solid #e5e7eb; border-radius: 9999px; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); transition: right 0.3s ease-in-out; }
    .sidebar-toggle-btn:hover { background-color: #f3f4f6; }

    /* Drop zone visual cue */
    .drop-active { background-color: #e0f2fe !important; outline: 2px dashed #0284c7; }
    /* File item style */
    .fileItem { border: 1px solid #ccc; padding: 0.5rem; text-align: center; cursor: grab; font-size: 0.75rem; background-color: white; word-break: break-all; min-height: 40px; display: flex; align-items: center; justify-content: center; }
    .fileItem a { text-decoration: underline; color: #2563eb; }
    /* Folder item style */
    .folderItem { border: 1px solid #ccc; padding: 0.5rem; border-radius: 0.25rem; cursor: pointer; text-align: center; display: flex; align-items: center; flex-shrink: 0; min-height: 40px; justify-content: center; font-size: 0.875rem; }
    .folderItem.selected { background-color: #dbeafe; }
    /* Add article placeholder */
    #addArticlePlaceholder { border: 2px dashed #9ca3af; color: #9ca3af; padding: 0.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer; min-height: 40px; grid-column: span 1; }
    /* Folder container */
    #folderContainer { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    /* Sortable table headers */
    #outreachTable th.sortable { cursor: pointer; position: relative; }
    #outreachTable th.sortable:hover { background-color: #e5e7eb; }
    #outreachTable th .sort-indicator { position: absolute; right: 5px; top: 50%; transform: translateY(-50%); font-size: 0.7rem; color: #6b7280; }
    /* Adjust list style for icons */
    .sidebar ul { list-style: none; padding: 0; }
    .sidebar li { display: flex; align-items: center; gap: 0.5rem; }

    /* --- New Status Counts Styles --- */
    #statusCounts .status-item {
        display: flex;
        justify-content: space-between; /* Pushes count group to the right */
        align-items: center;
        padding: 0.1rem 0; /* Adjust vertical spacing */
    }
    #statusCounts .status-label {
        color: #4b5563; /* text-gray-600 */
        font-size: 0.875rem; /* text-sm */
    }
    #statusCounts .status-values {
        font-size: 0.875rem; /* text-sm */
        color: #3b82f6; /* text-blue-500 */
        font-weight: 600; /* semibold */
        text-align: right;
    }
    #statusCounts .status-goal {
        cursor: pointer;
        text-decoration: underline dotted; /* Indicate editable */
         min-width: 20px; /* Ensure space for editing */
         display: inline-block; /* Needed for min-width */
    }
     #statusCounts .status-goal:hover {
         color: #1d4ed8; /* darker blue on hover */
     }
     /* Style for the input field when editing */
     #statusCounts input.goal-input {
        width: 40px; /* Adjust width as needed */
        text-align: right;
        border: 1px solid #ccc;
        border-radius: 0.25rem;
        padding: 0 0.25rem;
        font-size: 0.875rem; /* text-sm */
        -moz-appearance: textfield; /* Hide spinners in Firefox */
     }
     #statusCounts input.goal-input::-webkit-outer-spin-button,
     #statusCounts input.goal-input::-webkit-inner-spin-button {
        -webkit-appearance: none; /* Hide spinners in Chrome, Safari, Edge */
        margin: 0;
     }
    /* --- End Status Counts Styles --- */

  </style>
</head>
<body class="bg-white font-sans"> <!-- Initial state: expanded -->

  <!-- 6í˜ì´ì§€: íŒì—… ë·° -->
  <div id="viewOne" class="flex h-screen">
    <aside id="sidebarViewOne" class="sidebar bg-[#f9fafb] border-r p-4 flex flex-col items-center relative">
        <button id="toggleSidebarBtnViewOne" class="sidebar-toggle-btn">
            <span class="arrow"><</span>
        </button>
      <img src="logo.png" alt="Logo" class="w-28 mb-4"/>
      <div class="sidebar-text text-sm text-gray-500 mb-1">ì§„í–‰ì¤‘ì¸ ìº í˜ì¸</div>
      <div class="text-4xl text-blue-600 font-bold mb-2">3</div>
      <button class="sidebar-text text-pink-500 font-semibold mb-4">ìº í˜ì¸ ìƒì„±</button>
      <ul class="text-left space-y-2 w-full px-4">
        <li>ğŸ“<span class="sidebar-text"> ë‚˜ì˜ ìº í˜ì¸</span></li>
        <li>ğŸ“Š<span class="sidebar-text"> ë§ˆì¼€íŒ… ì—…ë¬´ ë„êµ¬</span></li>
        <li>ğŸ””<span class="sidebar-text"> ì•Œë¦¼ </span><span class="ml-2 text-blue-400 font-semibold sidebar-text">3</span></li>
      </ul>
    </aside>
    <main id="mainContentViewOne" class="main-content p-6 relative">
      <button id="openModalBtn"
              class="mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">
        + ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
      </button>
      <div id="modalOverlay"
           class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-lg w-96 mx-4">
          <div class="flex justify-between items-center border-b px-4 py-2">
            <h2 class="text-lg font-semibold">ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±</h2>
            <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">Ã—</button>
          </div>
          <form id="createProjectForm" class="p-4 space-y-4 text-sm">
            <div>
              <label class="block mb-1 font-medium">í”„ë¡œì íŠ¸ëª… <span class="text-red-500">*</span></label>
              <input id="projectNameInput" type="text" required placeholder="í”„ë¡œì íŠ¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                     class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"/>
            </div>
            <div>
              <label class="block mb-1 font-medium">ìº í˜ì¸ ê¸°ê°„</label>
              <div class="flex space-x-2">
                <input id="dateStartInput" type="date"
                       class="flex-1 border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"/>
                <span class="self-center">~</span>
                <input id="dateEndInput" type="date"
                       class="flex-1 border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"/>
              </div>
            </div>
            <div>
              <label class="block mb-1 font-medium">ëª©í‘œ ê°œìˆ˜</label>
              <input id="countGoalInput" type="number" min="0"
                     placeholder="ëª©í‘œ ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                     class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"/>
            </div>
            <div class="flex justify-end space-x-2 pt-2">
              <button type="button" id="cancelFormBtn"
                      class="px-4 py-2 border rounded hover:bg-gray-100">ì·¨ì†Œ</button>
              <button type="submit"
                      class="px-4 py-2 bg-black text-white rounded hover:bg-gray-900">ìƒì„±í•˜ê¸°</button>
            </div>
          </form>
        </div>
      </div>
    </main>
  </div>

  <!-- 7í˜ì´ì§€: ìƒì„¸ ë·° -->
  <div id="viewTwo" class="hidden flex h-screen overflow-y-auto">
    <aside id="sidebarViewTwo" class="sidebar bg-[#f9fafb] border-r p-4 flex flex-col items-center relative">
        <button id="toggleSidebarBtnViewTwo" class="sidebar-toggle-btn">
            <span class="arrow"><</span>
        </button>
      <img src="logo.png" alt="Logo" class="w-28 mb-4"/>
      <div class="sidebar-text text-sm text-gray-500 mb-1">ì§„í–‰ì¤‘ì¸ ìº í˜ì¸</div>
      <div class="text-4xl text-blue-600 font-bold mb-2">3</div>
      <button class="sidebar-text text-pink-500 font-semibold mb-4">ìº í˜ì¸ ìƒì„±</button>
      <ul class="text-left space-y-2 w-full px-4">
        <li class="text-red-600 font-semibold">ğŸ“<span class="sidebar-text"> ë‚˜ì˜ ìº í˜ì¸</span></li>
        <li>ğŸ“Š<span class="sidebar-text"> ë§ˆì¼€íŒ… ì—…ë¬´ ë„êµ¬</span></li>
        <li>ğŸ””<span class="sidebar-text"> ì•Œë¦¼ </span><span class="ml-2 text-blue-400 font-semibold sidebar-text">3</span></li>
      </ul>
    </aside>

    <main id="mainContentViewTwo" class="main-content p-4 space-y-6">
      <!-- HEADER -->
      <div class="border-t-4 border-yellow-300"></div>
      <div class="flex justify-between items-center border-b-2 border-blue-600 pb-2">
        <div class="flex space-x-6 text-sm font-semibold">
          <span id="projectTabTitle" class="text-red-600 border-b-2 border-red-600">â€”</span>
          <span>ì¡´ìŠ¨ì•¤ë“œì¡´ìŠ¨</span>
          <span>ë³´ì „í˜‘íšŒ</span>
          <span>í•˜ì´íŠ¸ì§„ë¡œ</span>
        </div>
        <div class="flex items-center space-x-6 text-sm font-semibold">
          <span class="text-purple-600">ë°ì‹œë³´ë“œ</span>
          <span>ê³µì§€ì‚¬í•­</span>
          <button id="goBackBtn" class="text-sm text-gray-600 hover:text-gray-800">â† ë’¤ë¡œÂ ê°€ê¸°</button>
        </div>
      </div>

      <div class="flex gap-4">
        <!-- ì¢Œì¸¡: ê¸°ê°„Â·ëª©í‘œÂ·MEMO + í…Œì´ë¸” -->
        <div class="w-1/2 space-y-4">
          <!-- ê¸°ê°„Â·ëª©í‘œÂ·MEMO -->
          <section class="flex gap-4">
            <div class="flex-1 border border-blue-300 p-4 rounded">
              <div class="font-bold mb-2">
                ê¸°ê°„ : <span id="displayPeriod">â€”</span>
                Â |Â 
                ëª©í‘œ ê°œìˆ˜: <span id="displayGoal">â€”</span>
              </div>
              <!-- Updated status counts section -->
              <div id="statusCounts" class="space-y-1 mt-2">
                <div class="status-item">
                    <span class="status-label">ë¦¬ìŠ¤íŠ¸ì—…</span>
                    <span class="status-values">
                        <span class="status-achieved" id="achieved-listup">0</span> /
                        <span class="status-goal" id="goal-listup" data-status-key="listup">-</span>
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">ê°€ì„­ì™¸ì‘ë‹µì</span>
                    <span class="status-values">
                        <span class="status-achieved" id="achieved-gaseobwae">0</span> /
                        <span class="status-goal" id="goal-gaseobwae" data-status-key="gaseobwae">-</span>
                    </span>
                </div>
                 <div class="status-item">
                    <span class="status-label">í™•ì •ì„­ì™¸</span>
                    <span class="status-values">
                        <span class="status-achieved" id="achieved-confirmed">0</span> /
                        <span class="status-goal" id="goal-confirmed" data-status-key="confirmed">-</span>
                    </span>
                </div>
                 <div class="status-item">
                    <span class="status-label">ë¸”ë¡œê·¸</span>
                    <span class="status-values">
                        <span class="status-achieved" id="achieved-blog">0</span> /
                        <span class="status-goal" id="goal-blog" data-status-key="blog">-</span>
                    </span>
                </div>
                 <div class="status-item">
                    <span class="status-label">ë§ˆì¼€í„°</span>
                    <span class="status-values">
                        <span class="status-achieved" id="achieved-marketer">0</span> /
                        <span class="status-goal" id="goal-marketer" data-status-key="marketer">-</span>
                    </span>
                </div>
                 <div class="status-item">
                    <span class="status-label">ê´‘ê³ ì£¼</span>
                    <span class="status-values">
                        <span class="status-achieved" id="achieved-client">0</span> /
                        <span class="status-goal" id="goal-client" data-status-key="client">-</span>
                    </span>
                </div>
                 <div class="status-item">
                    <span class="status-label">ë³´ê³ ì„œ</span>
                    <span class="status-values">
                        <span class="status-achieved" id="achieved-report">0</span> /
                        <span class="status-goal" id="goal-report" data-status-key="report">-</span>
                    </span>
                </div>
                 <div class="status-item">
                    <span class="status-label">ì •ì‚° ì™„ë£Œ</span>
                    <span class="status-values">
                        <span class="status-achieved" id="achieved-settled">0</span> /
                        <span class="status-goal" id="goal-settled" data-status-key="settled">-</span>
                    </span>
                </div>
              </div>
            </div>

            <!-- MEMO -->
            <div class="w-1/3 border border-gray-300 p-4 rounded text-center">
              <div class="font-semibold text-lg">MEMO</div>
              <div id="memoTextDisplay" class="mt-2 text-sm"></div>
              <div id="memoEditSection" class="mt-2 hidden">
                <textarea id="memoTextArea"
                          class="w-full border rounded p-2 text-sm"
                          rows="3"></textarea>
                <button id="memoConfirmBtn"
                        class="mt-2 px-4 py-1 bg-blue-600 text-white rounded">í™•ì¸</button>
              </div>
              <button id="memoEditBtn" class="mt-2 text-sm text-blue-500 underline">ìˆ˜ì •</button>
            </div>
          </section>

          <!-- ë¦¬ìŠ¤íŠ¸ì—… + Excel import -->
          <section class="border border-blue-300 p-4 rounded overflow-x-auto">
            <div class="flex justify-between items-center mb-2">
              <h3 class="font-bold">ì¸í”Œë£¨ì–¸ì„œ ê´€ë¦¬</h3>
              <div class="flex space-x-2">
                <button id="listAddBtn" class="text-sm text-purple-600 font-semibold">
                  + ë¦¬ìŠ¤íŠ¸ ì¶”ê°€
                </button>
                <!-- ** START: Added Download Button ** -->
                <button id="downloadReportBtn" class="text-sm text-blue-600 font-semibold">
                  ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ
                </button>
                <!-- ** END: Added Download Button ** -->
                <input type="file" id="excelFileInput" accept=".xlsx,.xls" class="hidden"/>
              </div>
            </div>
            <table id="outreachTable" class="w-full text-xs table-auto border">
              <thead class="bg-gray-100 text-left">
                <tr>
                  <th class="p-2">ì²´í¬</th>
                  <th class="p-2 sortable" data-sort-key="name">íŒŒì¼ëª…<span class="sort-indicator"></span></th>
                  <th class="p-2 sortable" data-sort-key="folder">í´ë”ìœ„ì¹˜<span class="sort-indicator"></span></th>
                  <th class="p-2 sortable" data-sort-key="lastModified">ìµœì¢…ìˆ˜ì •ë‚ ì§œ<span class="sort-indicator"></span></th>
                  <th class="p-2 sortable" data-sort-key="lastEditor">ë§ˆì§€ë§‰ì‘ì„±ì<span class="sort-indicator"></span></th>
                  <th class="p-2 sortable" data-sort-key="email">ë©”ì¼ì£¼ì†Œ<span class="sort-indicator"></span></th>
                  <th class="p-2 sortable" data-sort-key="contact">ì—°ë½ì²˜<span class="sort-indicator"></span></th>
                  <th class="p-2 sortable" data-sort-key="fee">ì›ê³ ë£Œ<span class="sort-indicator"></span></th>
                </tr>
              </thead>
              <tbody id="outreachTableBody"></tbody>
            </table>
          </section>
        </div>

        <!-- ìš°ì¸¡: ë„ì°©í•œ ì›ê³  + í´ë” + ì—…ë¬´ì¤‘ -->
        <div class="w-1/2 space-y-4">
          <!-- ë„ì°©í•œ ì›ê³  -->
          <section class="border border-blue-300 p-4 rounded">
            <h3 class="font-bold mb-2">ë„ì°©í•œ ì›ê³ </h3>
            <div id="linkInputSection" class="hidden mb-2 flex space-x-2 items-center">
              <input id="linkFileNameInput" type="text" placeholder="íŒŒì¼ëª… ì…ë ¥"
                     class="flex-1 border rounded px-2 py-1 text-sm h-8"/>
              <input id="linkUrlInput" type="url" placeholder="í•˜ì´í¼ë§í¬ (ì„ íƒ)"
                     class="flex-1 border rounded px-2 py-1 text-sm h-8"/>
              <button id="saveLinkButton"
                      class="px-3 py-1 bg-blue-600 text-white rounded text-sm h-8">ì €ì¥</button>
              <button id="cancelLinkButton" type="button"
                      class="px-3 py-1 bg-gray-300 text-black rounded text-sm h-8">ì·¨ì†Œ</button>
            </div>
            <div id="arrivalContainer"
                 class="grid grid-cols-5 gap-2 min-h-[80px] bg-white p-2 border rounded">
              <div class="fileItem" data-file-id="2">2ë²ˆ-ì„ë¸”ë¦¬.txt</div>
              <div class="fileItem" data-file-id="4">4ë²ˆ-ì„¸ìˆ˜í•˜ì—°.txt</div>
              <div class="fileItem" data-file-id="5">5ë²ˆ-íƒˆë¼ì¹¼ë¼.txt</div>
              <div id="addArticlePlaceholder">
                + ì›ê³  ì¶”ê°€
              </div>
            </div>
          </section>

          <!-- í´ë” ì„ íƒ -->
          <section class="border border-blue-300 p-4 rounded">
            <h3 class="font-bold mb-2">ì›ê³  ë¶„ë¥˜</h3>
            <div id="folderContainer">
              <div class="folderItem" data-folder-name="ë¦¬ìŠ¤íŠ¸ì—…">
                <span>ë¦¬ìŠ¤íŠ¸ì—…</span>
              </div>
              <div class="folderItem" data-folder-name="ê°€ì„­ì™¸ì‘ë‹µì">
                 <span>ê°€ì„­ì™¸ì‘ë‹µì</span>
              </div>
              <div class="folderItem" data-folder-name="í™•ì •ì„­ì™¸">
                 <span>í™•ì •ì„­ì™¸</span>
              </div>
              <div class="folderItem" data-folder-name="ë¸”ë¡œê·¸">
                 <span>ë¸”ë¡œê·¸</span>
              </div>
              <div class="folderItem" data-folder-name="ë§ˆì¼€í„°">
                 <span>ë§ˆì¼€í„°</span>
              </div>
              <div class="folderItem selected" data-folder-name="ê´‘ê³ ì£¼">
                 <span>ê´‘ê³ ì£¼</span>
              </div>
              <div class="folderItem" data-folder-name="ë³´ê³ ì„œ">
                 <span>ë³´ê³ ì„œ</span>
              </div>
              <div class="folderItem" data-folder-name="ì •ì‚° ì™„ë£Œ">
                 <span>ì •ì‚° ì™„ë£Œ</span>
              </div>
            </div>
            <div id="folderSelectionContainer" class="hidden"></div>
          </section>

          <!-- í´ë” ë‚´ íŒŒì¼ (ì—…ë¬´ì¤‘) -->
          <section class="border border-blue-300 p-4 rounded">
            <h3 class="font-bold mb-2">ì—…ë¬´ì¤‘ (<span id="currentFolderName">ê´‘ê³ ì£¼</span>)</h3>
            <div id="folderFilesContainer" class="grid grid-cols-5 gap-2 min-h-[80px] bg-white p-2 border rounded">
              <!-- Files from the selected folder will appear here -->
            </div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <script>
    (function(){
      document.addEventListener('DOMContentLoaded', () => {
        // --- Sidebar Toggle Logic ---
        const toggleButtons = document.querySelectorAll('.sidebar-toggle-btn');
        toggleButtons.forEach(button => {
            button.addEventListener('click', () => {
                document.body.classList.toggle('sidebar-collapsed');
                const arrow = button.querySelector('.arrow');
                if (arrow) { arrow.innerHTML = document.body.classList.contains('sidebar-collapsed') ? '>' : '<'; }
            });
        });
        // --- End Sidebar Toggle Logic ---


        // --- Existing View & Modal Control Code ---
        const openModalBtn      = document.getElementById('openModalBtn'),
              modalOverlay      = document.getElementById('modalOverlay'),
              closeModalBtn     = document.getElementById('closeModalBtn'),
              cancelFormBtn     = document.getElementById('cancelFormBtn'),
              createForm        = document.getElementById('createProjectForm'),
              viewOne           = document.getElementById('viewOne'),
              viewTwo           = document.getElementById('viewTwo'),
              projectNameInput  = document.getElementById('projectNameInput'),
              dateStartInput    = document.getElementById('dateStartInput'),
              dateEndInput      = document.getElementById('dateEndInput'),
              countGoalInput    = document.getElementById('countGoalInput'), // This is the *overall* goal input from the modal
              projectTabTitle   = document.getElementById('projectTabTitle'),
              displayPeriod     = document.getElementById('displayPeriod'),
              displayGoal       = document.getElementById('displayGoal'), // This displays the *overall* goal
              goBackBtn         = document.getElementById('goBackBtn');

        openModalBtn.addEventListener('click', ()=> modalOverlay.classList.remove('hidden'));
        closeModalBtn.addEventListener('click', ()=> modalOverlay.classList.add('hidden'));
        cancelFormBtn.addEventListener('click', ()=> modalOverlay.classList.add('hidden'));
        createForm.addEventListener('submit', e => {
          e.preventDefault();
          const currentProjectName = projectNameInput.value.trim(); // Get project name
          if (!currentProjectName) {
              alert('í”„ë¡œì íŠ¸ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
              return;
          }
          modalOverlay.classList.add('hidden');
          viewOne.classList.add('hidden');
          viewTwo.classList.remove('hidden');
          resetProjectData(currentProjectName); // Pass project name to reset/load data
          projectTabTitle.textContent = currentProjectName;
           const startDate = dateStartInput.value ? new Date(dateStartInput.value).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit'}).replace(/\.$/,'').replace(/\. /g,'.') : '-';
           const endDate = dateEndInput.value ? new Date(dateEndInput.value).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit'}).replace(/\.$/,'').replace(/\. /g,'.') : '-';
           displayPeriod.textContent = `${startDate} ~ ${endDate}`;
          displayGoal.textContent = countGoalInput.value || '-'; // Update overall goal display
          initializeViewTwoState(currentProjectName); // Pass project name
        });
        goBackBtn.addEventListener('click', ()=> {
          viewTwo.classList.add('hidden');
          viewOne.classList.remove('hidden');
        });
        // --- END: Existing View & Modal Control Code ---


        // ---- START: View Two Specific Logic ----

        // ìš”ì†Œ ì°¸ì¡°
        const arrivalContainer     = document.getElementById('arrivalContainer'),
              addArticlePlaceholder= document.getElementById('addArticlePlaceholder'),
              linkInputSection     = document.getElementById('linkInputSection'),
              linkFileNameInput    = document.getElementById('linkFileNameInput'),
              linkUrlInput         = document.getElementById('linkUrlInput'),
              saveLinkButton       = document.getElementById('saveLinkButton'),
              cancelLinkButton     = document.getElementById('cancelLinkButton'),
              folderContainer      = document.getElementById('folderContainer'),
              folderItems          = folderContainer.querySelectorAll('.folderItem'),
              folderFilesContainer = document.getElementById('folderFilesContainer'),
              currentFolderNameSpan= document.getElementById('currentFolderName'),
              outreachTable        = document.getElementById('outreachTable'),
              outreachTableBody    = document.getElementById('outreachTableBody'),
              memoTextDisplay      = document.getElementById('memoTextDisplay'),
              memoEditBtn          = document.getElementById('memoEditBtn'),
              memoEditSection      = document.getElementById('memoEditSection'),
              memoTextArea         = document.getElementById('memoTextArea'),
              memoConfirmBtn       = document.getElementById('memoConfirmBtn'),
              listAddBtn           = document.getElementById('listAddBtn'),
              excelFileInput       = document.getElementById('excelFileInput'),
              statusCountsContainer= document.getElementById('statusCounts'), // Reference the container for status items
              downloadReportBtn    = document.getElementById('downloadReportBtn'); // ** Added reference for download button **


        // Data Stores
        let currentProjectName = ''; // Store the currently active project name
        let assignedFiles = [];
        const folderKeys = [ // Define keys for easier iteration and mapping
            'listup', 'gaseobwae', 'confirmed', 'blog',
            'marketer', 'client', 'report', 'settled'
        ];
        const folderNameMap = { // Map keys to display/data names
            'listup': 'ë¦¬ìŠ¤íŠ¸ì—…',
            'gaseobwae': 'ê°€ì„­ì™¸ì‘ë‹µì',
            'confirmed': 'í™•ì •ì„­ì™¸',
            'blog': 'ë¸”ë¡œê·¸',
            'marketer': 'ë§ˆì¼€í„°',
            'client': 'ê´‘ê³ ì£¼',
            'report': 'ë³´ê³ ì„œ',
            'settled': 'ì •ì‚° ì™„ë£Œ'
        };
        let folderContents = {}; // Initialize dynamically based on map
        Object.values(folderNameMap).forEach(name => { folderContents[name] = []; });

        let selectedFolder = document.querySelector('#folderContainer .folderItem.selected')?.dataset.folderName || 'ê´‘ê³ ì£¼';
        let fileIdCounter = 100;
        let currentSort = { key: null, direction: 'asc' };

        // ---- Drag & Drop Helpers (unchanged) ----
        function enableDrag(el) {
          el.draggable = true; el.classList.add('cursor-grab');
          el.addEventListener('dragstart', ev => {
            const fileId = el.dataset.fileId || el.textContent.trim(); const fileContent = el.innerHTML; const sourceContainerId = el.closest('[id]').id;
            ev.dataTransfer.setData('text/plain', fileId); ev.dataTransfer.setData('text/html', fileContent); ev.dataTransfer.setData('sourceContainerId', sourceContainerId);
            ev.dataTransfer.effectAllowed = 'move'; el.classList.add('opacity-50');
          });
          el.addEventListener('dragend', ev => { el.classList.remove('opacity-50'); el.classList.remove('cursor-grab'); });
        }
        function enableDrop(el, dropHandler) {
          el.addEventListener('dragover', ev => { ev.preventDefault(); el.classList.add('drop-active'); ev.dataTransfer.dropEffect = 'move'; });
          el.addEventListener('dragleave', ev => { el.classList.remove('drop-active'); });
          el.addEventListener('drop', ev => {
             ev.preventDefault(); el.classList.remove('drop-active');
             const fileId = ev.dataTransfer.getData('text/plain'); const fileContent = ev.dataTransfer.getData('text/html'); const sourceContainerId = ev.dataTransfer.getData('sourceContainerId');
             dropHandler(fileId, fileContent, sourceContainerId, el);
          });
        }

        // ---- File & Folder Management Functions (unchanged logic) ----
        function createFileElement(fileId, fileContent) { const div = document.createElement('div'); div.className = 'fileItem'; div.dataset.fileId = fileId; div.innerHTML = fileContent; enableDrag(div); return div; }
        function renderFolderContents(folderName) { folderFilesContainer.innerHTML = ''; const files = folderContents[folderName] || []; files.forEach(fileData => { const fileElement = createFileElement(fileData.id, fileData.content); folderFilesContainer.appendChild(fileElement); }); currentFolderNameSpan.textContent = folderName; }
        function selectFolder(folderElement) { const currentFolderItems = folderContainer.querySelectorAll('.folderItem'); currentFolderItems.forEach(f => f.classList.remove('selected')); folderElement.classList.add('selected'); selectedFolder = folderElement.dataset.folderName; renderFolderContents(selectedFolder); }
        function findFileElementById(container, fileId) { return container.querySelector(`[data-file-id="${fileId}"]`) || Array.from(container.querySelectorAll('.fileItem')).find(el => el.textContent.trim() === fileId); }
        function removeFileFromFolders(fileId) { for (const folderName in folderContents) { if (folderContents[folderName]) { const index = folderContents[folderName].findIndex(f => f.id === fileId); if (index > -1) { folderContents[folderName].splice(index, 1); return folderName; } } } return null; }
        function addFileToFolder(fileId, fileContent, folderName) { if (!folderContents[folderName]) { folderContents[folderName] = []; console.warn(`Created new folder in data store: "${folderName}"`); } if (!folderContents[folderName].some(f => f.id === fileId)) { folderContents[folderName].push({ id: fileId, content: fileContent }); } }

        // ---- Status Count & Goal Update ----
        function updateStatusCounts() {
            const counts = {};
            folderKeys.forEach(key => counts[key] = 0); // Initialize counts

            assignedFiles.forEach(file => {
                const folderKey = Object.keys(folderNameMap).find(key => folderNameMap[key] === file.folder);
                if (folderKey && counts.hasOwnProperty(folderKey)) {
                    counts[folderKey]++;
                }
            });

            // Update achieved values in the DOM
            folderKeys.forEach(key => {
                const achievedEl = document.getElementById(`achieved-${key}`);
                if (achievedEl) {
                    achievedEl.textContent = counts[key];
                }
            });
        }

        function loadGoals(projectName) {
             if (!projectName) return;
             folderKeys.forEach(key => {
                 const goalEl = document.getElementById(`goal-${key}`);
                 if (goalEl) {
                     const savedGoal = localStorage.getItem(`${projectName}_goal_${key}`) ?? '-'; // Default to '-'
                     goalEl.textContent = savedGoal;
                 }
             });
         }

         function saveGoal(projectName, statusKey, value) {
             if (!projectName || !statusKey) return;
             const goalValue = parseInt(value, 10);
             // Save only if it's a non-negative number
             if (!isNaN(goalValue) && goalValue >= 0) {
                 localStorage.setItem(`${projectName}_goal_${statusKey}`, goalValue);
                 return goalValue; // Return the saved number
             } else {
                 // If input is invalid or empty, remove from storage or save default like '-'
                 localStorage.removeItem(`${projectName}_goal_${statusKey}`);
                 //alert("ìœ íš¨í•œ ìˆ«ì ëª©í‘œê°’ì„ ì…ë ¥í•˜ì„¸ìš” (0 ì´ìƒ).");
                 return '-'; // Return default display value
             }
         }

         function makeGoalEditable(spanElement) {
            const currentGoal = spanElement.textContent;
            const statusKey = spanElement.dataset.statusKey;

            const input = document.createElement('input');
            input.type = 'number';
            input.min = '0';
            input.className = 'goal-input';
            input.value = (currentGoal === '-' || isNaN(parseInt(currentGoal))) ? '' : currentGoal; // Set empty if default or NaN

            spanElement.replaceWith(input);
            input.focus();
            input.select(); // Select text for easy replacement

            const saveAndReplace = () => {
                const newGoal = saveGoal(currentProjectName, statusKey, input.value);
                const newSpan = document.createElement('span');
                newSpan.className = 'status-goal';
                newSpan.id = `goal-${statusKey}`;
                newSpan.dataset.statusKey = statusKey;
                newSpan.textContent = newGoal;
                newSpan.addEventListener('click', () => makeGoalEditable(newSpan)); // Re-attach listener
                input.replaceWith(newSpan);
            };

            input.addEventListener('blur', saveAndReplace);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent form submission if any
                    saveAndReplace();
                } else if (e.key === 'Escape') {
                    // Restore original span without saving
                     const originalSpan = document.createElement('span');
                     originalSpan.className = 'status-goal';
                     originalSpan.id = `goal-${statusKey}`;
                     originalSpan.dataset.statusKey = statusKey;
                     originalSpan.textContent = currentGoal; // Restore original text
                     originalSpan.addEventListener('click', () => makeGoalEditable(originalSpan));
                     input.replaceWith(originalSpan);
                }
            });
        }


        // ---- Table Management & Sorting Functions ----
        function refreshTable(){
            if (currentSort.key) {
                assignedFiles.sort((a, b) => {
                    let valA = a[currentSort.key] ?? ''; let valB = b[currentSort.key] ?? '';
                    if (currentSort.key === 'lastModified') { valA = new Date(valA); valB = new Date(valB); if (isNaN(valA)) valA = 0; if (isNaN(valB)) valB = 0; }
                    else if (currentSort.key === 'fee') { valA = parseFloat(String(valA).replace(/[^0-9.-]+/g,"")) || 0; valB = parseFloat(String(valB).replace(/[^0-9.-]+/g,"")) || 0; }
                    else { valA = String(valA); valB = String(valB); return currentSort.direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA); }
                    if (valA < valB) return currentSort.direction === 'asc' ? -1 : 1;
                    if (valA > valB) return currentSort.direction === 'asc' ? 1 : -1;
                    return 0;
                });
            }
            outreachTableBody.innerHTML = '';
             if (assignedFiles.length === 0 && !viewTwo.classList.contains('hidden')) { addSampleTableData(); }
            [...assignedFiles].forEach(f => {
                const tr = document.createElement('tr'); let displayDate = 'N/A';
                if (f.lastModified) { try { displayDate = new Date(f.lastModified).toLocaleString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true }).replace(/\.$/,'').replace(/\. /g,'.'); } catch (e) { /* Keep N/A */ } }
                tr.innerHTML = ` <td class="p-2 border"><input type="checkbox"/></td> <td class="p-2 border">${f.name || 'N/A'}</td> <td class="p-2 border">${f.folder || 'N/A'}</td> <td class="p-2 border">${displayDate}</td> <td class="p-2 border">${f.lastEditor || 'N/A'}</td> <td class="p-2 border">${f.email || ''}</td> <td class="p-2 border">${f.contact || ''}</td> <td class="p-2 border">${f.fee || ''}</td> `;
                if (outreachTableBody) { outreachTableBody.append(tr); }
            });
            const headers = outreachTable.querySelectorAll('th.sortable');
            headers.forEach(th => { const indicator = th.querySelector('.sort-indicator'); if (indicator) { indicator.textContent = (th.dataset.sortKey === currentSort.key) ? (currentSort.direction === 'asc' ? ' â–²' : ' â–¼') : ''; } });
            updateStatusCounts(); // Update counts after table is drawn
         }

        function addSampleTableData() {
             const sampleData = [ { id: 'link-105', name: 'ã…ˆã„·ã„±ã…ˆã„·ã„±', folder: 'ë¦¬ìŠ¤íŠ¸ì—…', lastModified: '2025-04-21T14:24:16Z', lastEditor: 'Me', email: '', contact: '', fee: '' }, { id: 'excel-106', name: '24. ìëª½', folder: 'ë¦¬ìŠ¤íŠ¸ì—…', lastModified: '2025-04-21T14:24:15Z', lastEditor: 'Me', email: '', contact: '', fee: '' }, { id: 'excel-107', name: '23. ê°ê·¤', folder: 'í™•ì •ì„­ì™¸', lastModified: '2025-04-21T14:24:21Z', lastEditor: 'Me', email: '', contact: '', fee: '' }, { id: 'excel-100', name: '1. ê½ƒë´„.txt', folder: 'N/A', lastModified: '2025-04-21T13:50:02Z', lastEditor: 'Import', email: '', contact: '', fee: '' }, { id: 'excel-101', name: '1. ê½ƒë´„.txt', folder: 'N/A', lastModified: '2025-04-21T13:50:02Z', lastEditor: 'Import', email: '', contact: '', fee: '' }, { id: 'excel-102', name: '1. ê½ƒë´„.txt', folder: 'N/A', lastModified: '2025-04-21T13:50:02Z', lastEditor: 'Import', email: '', contact: '', fee: '' }, { id: 'excel-103', name: '1. ê½ƒë´„.txt', folder: 'N/A', lastModified: '2025-04-21T13:50:02Z', lastEditor: 'Import', email: '', contact: '', fee: '' }, { id: 'excel-104', name: '1. ê½ƒë´„.txt', folder: 'N/A', lastModified: '2025-04-21T13:50:02Z', lastEditor: 'Import', email: '', contact: '', fee: '' }, { id: 'excel-108', name: '21. ë°”ë‚˜ë‚˜', folder: 'N/A', lastModified: '2025-04-21T14:22:14Z', lastEditor: 'Me', email: '', contact: '', fee: '' }, { id: 'excel-109', name: '22. ë”¸ê¸°', folder: 'N/A', lastModified: '2025-04-21T14:22:28Z', lastEditor: 'Me', email: '', contact: '', fee: '' }, { id: 'excel-110', name: '25. ì‚¬ê³¼', folder: 'N/A', lastModified: '2025-04-21T14:23:20Z', lastEditor: 'Me', email: '', contact: '', fee: '' }, { id: 'excel-111', name: '27. í¬ë„', folder: 'N/A', lastModified: '2025-04-21T14:24:07Z', lastEditor: 'Me', email: '', contact: '', fee: '' } ];
             if(assignedFiles.length === 0) { assignedFiles = sampleData; }
         }

        function upsertAssignedFile(fileId, fileContent, folderName) {
            const fileNameMatch = fileContent.match(/>(.*?)</); const fileName = fileNameMatch ? fileNameMatch[1] : fileContent;
            const existingIndex = assignedFiles.findIndex(f => (f.id === fileId) || (f.name === fileName && !f.id && fileId.startsWith('link-')));
            const fileData = { id: fileId, name: fileName, folder: folderName, lastModified: new Date().toISOString(), lastEditor: 'Me', email: existingIndex > -1 ? assignedFiles[existingIndex].email : '', contact: existingIndex > -1 ? assignedFiles[existingIndex].contact : '', fee: existingIndex > -1 ? assignedFiles[existingIndex].fee : '', };
            if (existingIndex > -1) { assignedFiles[existingIndex].folder = fileData.folder; assignedFiles[existingIndex].lastModified = fileData.lastModified; assignedFiles[existingIndex].lastEditor = fileData.lastEditor; }
            else { assignedFiles.push(fileData); }
            refreshTable(); // Updates table and counts
        }

        function removeAssignedFile(fileId) { const initialLength = assignedFiles.length; assignedFiles = assignedFiles.filter(f => f.id !== fileId); if (assignedFiles.length < initialLength) { refreshTable(); } } // Updates table and counts

        // ---- Drop Handlers (unchanged logic) ----
         const handleDropOnFolder = (fileId, fileContent, sourceContainerId, targetFolderElement) => {
            const targetFolderName = targetFolderElement.dataset.folderName; const sourceContainer = document.getElementById(sourceContainerId); let sourceElement = null;
            if (sourceContainer) { sourceElement = findFileElementById(sourceContainer, fileId); if (sourceElement) { sourceContainer.removeChild(sourceElement); } }
            else { console.warn("Drop source container not found:", sourceContainerId); sourceElement = document.querySelector(`[data-file-id="${fileId}"]`); if (sourceElement?.parentElement) { sourceElement.parentElement.removeChild(sourceElement); } else { return; } }
            removeFileFromFolders(fileId); addFileToFolder(fileId, fileContent, targetFolderName); upsertAssignedFile(fileId, fileContent, targetFolderName); selectFolder(targetFolderElement);
        };
        const handleDropOnArrival = (fileId, fileContent, sourceContainerId, targetContainerElement) => {
            if (sourceContainerId !== 'folderFilesContainer') return; const sourceContainer = document.getElementById(sourceContainerId); let sourceElement = null;
             if (sourceContainer) { sourceElement = findFileElementById(sourceContainer, fileId); if (sourceElement) { sourceContainer.removeChild(sourceElement); } else { return; } } else { return; }
            removeFileFromFolders(fileId); removeAssignedFile(fileId); const newElement = createFileElement(fileId, fileContent); const placeholder = arrivalContainer.querySelector('#addArticlePlaceholder');
            if (placeholder) { arrivalContainer.insertBefore(newElement, placeholder); } else { arrivalContainer.appendChild(newElement); }
        };

        // ---- Event Listener Setup ----
        arrivalContainer.querySelectorAll('.fileItem').forEach(enableDrag);
        folderContainer.querySelectorAll('.folderItem').forEach(folder => { folder.addEventListener('click', () => selectFolder(folder)); enableDrop(folder, handleDropOnFolder); });
        enableDrop(arrivalContainer, handleDropOnArrival);
         enableDrop(folderFilesContainer, (fileId, fileContent, sourceContainerId, targetContainerElement) => { const currentSelectedFolderElement = folderContainer.querySelector('.folderItem.selected'); if (currentSelectedFolderElement) { handleDropOnFolder(fileId, fileContent, sourceContainerId, currentSelectedFolderElement); } });
        outreachTable.querySelectorAll('th.sortable').forEach(th => { th.addEventListener('click', () => { const sortKey = th.dataset.sortKey; if (!sortKey) return; let newDirection = (currentSort.key === sortKey && currentSort.direction === 'asc') ? 'desc' : 'asc'; currentSort.key = sortKey; currentSort.direction = newDirection; refreshTable(); }); });

        // Add listeners for making goals editable
         statusCountsContainer.querySelectorAll('.status-goal').forEach(span => {
             span.addEventListener('click', () => makeGoalEditable(span));
         });


        // ---- +ì›ê³  ì¶”ê°€ Logic (unchanged logic) ----
        if (addArticlePlaceholder) { addArticlePlaceholder.addEventListener('click', () => { linkInputSection.classList.remove('hidden'); addArticlePlaceholder.classList.add('hidden'); linkFileNameInput.focus(); }); }
        cancelLinkButton.addEventListener('click', () => { linkInputSection.classList.add('hidden'); const placeholder = arrivalContainer.querySelector('#addArticlePlaceholder'); if (placeholder) { placeholder.classList.remove('hidden'); } linkFileNameInput.value = ''; linkUrlInput.value = ''; });
        saveLinkButton.addEventListener('click', () => {
            const name = linkFileNameInput.value.trim(); const url = linkUrlInput.value.trim();
            if (!name) { alert('íŒŒì¼ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'); linkFileNameInput.focus(); return; }
            if (url && !url.startsWith('http://') && !url.startsWith('https://') && !url.startsWith('/')) { alert('ìœ íš¨í•œ URL í˜•ì‹(http://, https:// ë˜ëŠ” / ë¡œ ì‹œì‘)ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.'); linkUrlInput.focus(); return; }
            const fileId = `link-${fileIdCounter++}`; let fileContent = url ? `<a href="${url}" target="_blank" class="underline text-blue-600">${name}</a>` : name;
            const newElement = createFileElement(fileId, fileContent); upsertAssignedFile(fileId, name, 'N/A'); // Note: Adding link always adds to table initially with folder N/A
            const placeholder = arrivalContainer.querySelector('#addArticlePlaceholder');
             if (placeholder) { arrivalContainer.insertBefore(newElement, placeholder); } else { arrivalContainer.appendChild(newElement); }
            linkFileNameInput.value = ''; linkUrlInput.value = ''; linkInputSection.classList.add('hidden'); if (placeholder) { placeholder.classList.remove('hidden'); }
        });

        // ---- MEMO (Existing code - unchanged) ----
        // ** Updated to use currentProjectName for unique memo storage **
        function loadMemo(projectName) {
            const savedMemo = localStorage.getItem(`${projectName}_memo`) || 'ë©”ëª¨ ì—†ìŒ';
            memoTextDisplay.textContent = savedMemo;
            memoTextArea.value = savedMemo; // Also update textarea in case edit is cancelled
        }
        function saveMemo(projectName, text) {
             localStorage.setItem(`${projectName}_memo`, text);
        }
        memoEditBtn.addEventListener('click', () => {
             memoTextDisplay.classList.add('hidden');
             memoEditBtn.classList.add('hidden');
             memoTextArea.value = memoTextDisplay.textContent; // Ensure current value is in textarea
             memoEditSection.classList.remove('hidden');
             memoTextArea.focus();
        });
        memoConfirmBtn.addEventListener('click', () => {
             const txt = memoTextArea.value.trim();
             saveMemo(currentProjectName, txt); // Save with project name
             memoTextDisplay.textContent = txt;
             memoTextDisplay.classList.remove('hidden');
             memoEditBtn.classList.remove('hidden');
             memoEditSection.classList.add('hidden');
        });

        // ---- ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ -> Excel import (Modified to use ISO dates) ----
        listAddBtn.addEventListener('click', () => excelFileInput.click());
        excelFileInput.addEventListener('change', e => {
            const file = e.target.files[0]; if (!file) return; const reader = new FileReader();
            reader.onload = evt => {
                try {
                    const wb = XLSX.read(evt.target.result, { type: 'binary' }); const sheet = wb.Sheets[wb.SheetNames[0]]; const rows = XLSX.utils.sheet_to_json(sheet, { defval: '', raw: false });
                    rows.forEach((r, index) => {
                        const fileId = `excel-${fileIdCounter++}`; const fileName = r['íŒŒì¼ëª…'] || r['Name'] || `Imported ${index + 1}`; let lastModifiedDate = new Date(); const excelDate = r['ìµœì¢…ìˆ˜ì •ë‚ ì§œ'] || r['Last Modified'];
                         if (excelDate) { if (excelDate instanceof Date) { lastModifiedDate = excelDate; } else { try { const parsed = new Date(String(excelDate).replace(/\./g, '-').replace('ì˜¤í›„', 'PM').replace('ì˜¤ì „', 'AM')); if (!isNaN(parsed)) lastModifiedDate = parsed; } catch (dateError) { /* Ignore */ } } }
                        // Check if file with this *name* already exists from Excel import (avoid duplicate imports)
                        if (!assignedFiles.some(f => f.name === fileName && f.id.startsWith('excel-'))) {
                             assignedFiles.push({ id: fileId, name: fileName, folder: r['í´ë”ìœ„ì¹˜'] || r['Folder'] || 'N/A', lastModified: lastModifiedDate.toISOString(), lastEditor: r['ë§ˆì§€ë§‰ì‘ì„±ì'] || 'Import', email: r['ë©”ì¼ì£¼ì†Œ'] || r['Email'] || '', contact: r['ì—°ë½ì²˜'] || r['Contact'] || '', fee: r['ì›ê³ ë£Œ'] || r['Fee'] || '' });
                        } else {
                            console.warn(`Skipping duplicate Excel import row: ${fileName}`);
                        }
                    });
                    refreshTable(); excelFileInput.value = '';
                } catch (error) { console.error("Error processing Excel file:", error); alert("ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
            };
            reader.onerror = () => { alert("íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); excelFileInput.value = ''; };
            reader.readAsBinaryString(file);
        });

        // ---- ** START: Excel Report Download Logic ** ----
        downloadReportBtn.addEventListener('click', () => {
            if (assignedFiles.length === 0) {
                alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // 1. Define Headers for the Excel file (Use Korean names)
            const headers = [
                'íŒŒì¼ëª…', 'í´ë”ìœ„ì¹˜', 'ìµœì¢…ìˆ˜ì •ë‚ ì§œ', 'ë§ˆì§€ë§‰ì‘ì„±ì', 'ë©”ì¼ì£¼ì†Œ', 'ì—°ë½ì²˜', 'ì›ê³ ë£Œ'
            ];

            // 2. Prepare data rows matching the headers
            const dataForSheet = assignedFiles.map(file => {
                let displayDate = 'N/A';
                if (file.lastModified) {
                    try {
                        // Use the same date formatting as the table for consistency
                        displayDate = new Date(file.lastModified).toLocaleString('ko-KR', {
                            year: 'numeric', month: '2-digit', day: '2-digit',
                            hour: '2-digit', minute: '2-digit', second: '2-digit',
                            hour12: true // Or false for 24-hour format
                        }).replace(/\.$/,'').replace(/\. /g,'.');
                    } catch (e) { /* Keep N/A */ }
                }
                return [
                    file.name || 'N/A',
                    file.folder || 'N/A',
                    displayDate,
                    file.lastEditor || 'N/A',
                    file.email || '',
                    file.contact || '',
                    file.fee || ''
                    // We exclude the checkbox and internal ID from the report
                ];
            });

            // 3. Combine headers and data rows
            const sheetData = [headers, ...dataForSheet];

            // 4. Create a worksheet
            const ws = XLSX.utils.aoa_to_sheet(sheetData);

            // Optional: Adjust column widths (example)
             ws['!cols'] = [ { wch: 25 }, { wch: 15 }, { wch: 20 }, { wch: 15 }, { wch: 25 }, { wch: 15 }, { wch: 10 } ]; // Adjust widths as needed

            // 5. Create a workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ì¸í”Œë£¨ì–¸ì„œ ë¦¬í¬íŠ¸'); // Name the sheet

            // 6. Generate a filename (e.g., ProjectName_Report_YYYYMMDD.xlsx)
            const today = new Date();
            const dateString = `${today.getFullYear()}${(today.getMonth() + 1).toString().padStart(2, '0')}${today.getDate().toString().padStart(2, '0')}`;
            // Use currentProjectName which should be available in this scope
            const safeProjectName = (currentProjectName || 'í”„ë¡œì íŠ¸').replace(/[^a-z0-9ã„±-ã…ã…-ã…£ê°€-í£_-]/gi, '_'); // Sanitize name for filename
            const fileName = `${safeProjectName}_ë¦¬í¬íŠ¸_${dateString}.xlsx`;

            // 7. Trigger the download
            XLSX.writeFile(wb, fileName);
        });
        // ---- ** END: Excel Report Download Logic ** ----


        // ---- Initialization ----
        function resetProjectData(projectName) {
             currentProjectName = projectName || ''; // Store current project name
             assignedFiles = []; // Clear file data
             // Reinitialize folder contents
             folderContents = {};
             Object.values(folderNameMap).forEach(name => { folderContents[name] = []; });

             selectedFolder = document.querySelector('#folderContainer .folderItem.selected')?.dataset.folderName || 'ê´‘ê³ ì£¼';
             fileIdCounter = 100; currentSort = { key: null, direction: 'asc' };
             outreachTableBody.innerHTML = ''; folderFilesContainer.innerHTML = '';

             // Reset arrival container (clearing existing items)
             arrivalContainer.innerHTML = '';
             // Add the placeholder back
             const placeholderDiv = document.createElement('div');
             placeholderDiv.id = 'addArticlePlaceholder';
             placeholderDiv.innerHTML = '+ ì›ê³  ì¶”ê°€';
             placeholderDiv.className = 'border-2 border-dashed border-gray-400 text-gray-400 p-2 flex items-center justify-center cursor-pointer min-h-[40px] col-span-1'; // Re-apply classes
             arrivalContainer.appendChild(placeholderDiv);
             // Re-attach listener to the *new* placeholder
             placeholderDiv.addEventListener('click', () => {
                 linkInputSection.classList.remove('hidden');
                 placeholderDiv.classList.add('hidden');
                 linkFileNameInput.focus();
             });
             // Reset the link input section
             linkInputSection.classList.add('hidden'); linkFileNameInput.value = ''; linkUrlInput.value = '';

             // Reset folder selection visually
             const currentFolderItems = folderContainer.querySelectorAll('.folderItem');
             currentFolderItems.forEach(f => f.classList.remove('selected'));
             const defaultSelectedFolder = folderContainer.querySelector(`.folderItem[data-folder-name="${selectedFolder}"]`);
             if (defaultSelectedFolder) { defaultSelectedFolder.classList.add('selected'); }
             else if (currentFolderItems.length > 0) { currentFolderItems[0].classList.add('selected'); selectedFolder = currentFolderItems[0].dataset.folderName; }
             currentFolderNameSpan.textContent = selectedFolder;

             // Reset table sort indicators
             outreachTable.querySelectorAll('th .sort-indicator').forEach(ind => ind.textContent = '');

             // Reset status counts and goals visually
             folderKeys.forEach(key => {
                 const achievedEl = document.getElementById(`achieved-${key}`);
                 const goalEl = document.getElementById(`goal-${key}`);
                 if (achievedEl) achievedEl.textContent = '0';
                 if (goalEl) goalEl.textContent = '-'; // Reset goal display
             });
             // Reset memo using the load function
             loadMemo(currentProjectName);
             memoEditSection.classList.add('hidden'); // Ensure edit section is hidden
             memoTextDisplay.classList.remove('hidden');
             memoEditBtn.classList.remove('hidden');
        }

        function initializeViewTwoState(projectName) {
             currentProjectName = projectName || ''; // Ensure project name is set
             const initialFolder = folderContainer.querySelector('.folderItem.selected');
             if (initialFolder) { selectFolder(initialFolder); }
             else { const currentFolderItems = folderContainer.querySelectorAll('.folderItem'); if (currentFolderItems.length > 0) { selectFolder(currentFolderItems[0]); } }

             // Add sample data *only if* no specific project data is intended to be loaded later
             // For a real application, you'd likely fetch project-specific data here instead
             if (assignedFiles.length === 0) {
                 addSampleTableData();
             }
             currentSort.key = 'lastModified'; currentSort.direction = 'desc'; // Set initial sort

             loadGoals(currentProjectName); // Load goals for the current project
             loadMemo(currentProjectName); // Load memo for the current project
             refreshTable(); // Refresh table (applies sort, updates counts)

             arrivalContainer.querySelectorAll('.fileItem').forEach(enableDrag);
             folderFilesContainer.querySelectorAll('.fileItem').forEach(enableDrag);

              // Re-attach listeners for making goals editable after potential reset
             statusCountsContainer.querySelectorAll('.status-goal').forEach(span => {
                 span.removeEventListener('click', makeGoalEditable); // Remove old listener if any
                 span.addEventListener('click', () => makeGoalEditable(span));
             });
        }

        // Initialize if viewTwo is already visible on page load (e.g., during development/debugging)
        // if (!viewTwo.classList.contains('hidden')) { initializeViewTwoState('DefaultProject'); } // Use a default name or handle appropriately

      }); // End DOMContentLoaded
    })();
  </script>
</body>
</html>
